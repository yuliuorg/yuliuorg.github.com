<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="author" content="刘昱" />
		
		<title>刘昱 | python实现文件和系统剪贴板读写 </title>
		
		<link rel="shortcut icon" href="/media/images/siteimg/favicon.ico">
		<link href="http://yuliu.org/feed/" rel="alternate" title="刘昱" type="application/atom+xml" />
		<link rel="stylesheet" href="/media/css/style.css" type="text/css" />
		<link rel="stylesheet" href="/media/script/prettify/prettify.css" type="text/css" />
		<script type="text/javascript" src="/media/script/prettify/prettify.js"></script> 
		<script type="text/javascript" src="/media/script/jquery-1.7.2.min.js"></script>
		<!--[if IE]>
		<script type="text/javascript" src="/media/script/html5shiv.js"></script> 
		<![endif]-->		
		<script type="text/javascript" src="/media/script/default.js"></script>
		
		<!--MathJax-->
		
		<!--Google Analytics-->
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-33277878-1']);
			_gaq.push(['_setDomainName', 'yuliu.org']);
			_gaq.push(['_trackPageview']);
			_gaq.push(['_trackPageLoadTime']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
		<!--Baidu Tongji-->
		<script>
			var _hmt = _hmt || [];
			(function() {
  				var hm = document.createElement("script");
  				hm.src = "//hm.baidu.com/hm.js?48a6a4d484b4cface9c1feb925c3129e";
  				var s = document.getElementsByTagName("script")[0]; 
  				s.parentNode.insertBefore(hm, s);
			})();
		</script>
		
	
	</head>
	<body>

		<div id="container">
			<header>
			<a href="http://en.wikipedia.org/wiki/Chicago_Pile-1"><img id="siteimage" src="/media/images/siteimg/Chicago_Pile.jpg" title="Chicago Pile 1" alt="Chicago Pile 1" /></a>
			<h1>刘 昱</h1>
			<h2>核能动力系统设计工程师</h2>
			</header>
			<nav>
			<span><a title="首页" class="" href="http://yuliu.org/">主页</a></span>
			<span><a title="简历" class="" href="http://yuliu.org/vitae/">简历</a></span>
			<span><a title="文章" class="" href="http://yuliu.org/publication/">文章</a></span>
			<span><a title="关于" class="" href="http://yuliu.org/about/">关于</a></span>
			<span><a title="留言" class="" href="http://yuliu.org/guestbook/">留言</a></span>
			<span><a title="链接" class="" href="http://yuliu.org/link/">链接</a></span>
			<span><a title="杂货铺" class="" href="http://yuliu.org/essay">杂货铺</a></span>
			</nav>
			<div id="main" role="main">
				<article class="content">
				<section class="title">
<h1>python实现文件和系统剪贴板读写</h1>
</section>
<section class="post">
<p>最近有一个无聊的需求，某网页上复制一些文字，接着去除每段开始和结尾的空格，并在段与段之间增加一个空行。从来没有用过python干过实际的事情，正好拿来熟悉熟悉。</p>

<p>首先的想法是把<em>手动把网页文字复制到文件中，手动执行python调整格式并写入输出文件，从手动文件中再复制</em>，照着这个思路，实现很简单</p>

<pre><code># -*- coding: utf8 -*- 
fin = open('input.txt', 'r')
fout = open ('output.txt','w')
linepre = 'BOF'
for line in fin.readlines():
    newline = line.strip(' ').strip('　').strip(' ')  #注意中间一个是中文空格，处理首尾中英空格混合的情况
    if newline=='\n':
        continue
    fout.writelines(newline)
    if linepre != '\n':
        fout.writelines('\n')
    linepre=newline
fin.close()
fout.close()
</code></pre>

<p>由于代码中使用了中文空格，所以代码第一行声明使用UTF-8编码。done，按需求完成任务。</p>

<p>后来一想，这个思路也绕得有点多了，为什么不<em>手动执行程序后，程序直接从剪贴板读取复制的文字，调整格式后直接输出到剪贴板</em>呢？</p>

<p>python不能直接输入输出到剪贴板，于是放狗搜索，<a href="http://sourceforge.net/projects/pywin32/">pywin32</a>、<a href="http://coffeeghost.net/2010/10/09/pyperclip-a-cross-platform-clipboard-module-for-python/">Pyperclip</a>都是可选的解决方案。两者比较，后者体积小、能够跨平台，自然成为首选，下载后，丢到<code>Python27\Lib\</code>文件夹</p>

<p>这样，对上一段代码进行适应性修改（花了点时间）就能满足新的思路</p>

<pre><code># -*- coding: utf8 -*- 
import pyperclip
content=pyperclip.paste()
output = ""
for line in content.split('\r\n'):
    newline = line.strip(' ').strip('\xa1').strip(' ')
    if not newline:
        continue
    output += (newline + '\r\n\r\n')
pyperclip.copy(output)
</code></pre>

<p>需要注意的是，此处直接strip中文空格不好使，需要用<code>\xa1</code>表示中文空格。</p>

<h1>update:2012-07-27</h1>

<p>这两天使用中发现当段首为中文符号，例如“或者《时，该段会出现乱码。放狗虽然没有找到直接的答案，但还是找到了一丝提示，主要问题应该是出在对python字符串和编码的理解上。</p>

<p>python的str是一个字节数组，这个字节数组表示的是对unicode对象编码(可以是utf-8、gbk、cp936、GB2312)后的存储的格式。因此，它仅仅是一个字节流，没有其它的含义，例如</p>

<pre><code>&gt;&gt;&gt; str='核能设计工程师'
&gt;&gt;&gt; str
'\xba\xcb\xc4\xdc\xc9\xe8\xbc\xc6\xb9\xa4\xb3\xcc\xca\xa6'
</code></pre>

<p>即在python中使用<code>\xba\xcb\xc4\xdc\xc9\xe8\xbc\xc6\xb9\xa4\xb3\xcc\xca\xa6'</code>存放<code>核能设计工程师</code>。而中文空格对应<code>\xa1\xa1</code>，“对应<code>\xa1\xb0</code></p>

<p>因此，<code>strip('\xa1')</code>时也会将“中的第一个<code>\xa1</code>也一块去掉，只留下<code>\xb0</code>，从而导致了乱码的出现。那么使用<code>strip('\xa1\xa1')</code>行不行呢？答案是不行，因为python的strip和C#的trim还不一样，参数不是前缀或是后缀，而是其中字符集的组合（<a href="http://docs.python.org/library/stdtypes.html#str.strip">python文档</a>），因此仍然会把“的第一个<code>\xa1</code>去掉。</p>

<p>于是该情况下，同时考虑到居中很少出现中文空格，所以使用<a href="http://docs.python.org/library/stdtypes.html#str.replace">replace</a>替代strip去掉中文空格作为一个临时解决方案。</p>

<p>小结，更新后代码如下：</p>

<pre><code># -*- coding: utf8 -*-
import pyperclip
content=pyperclip.paste()
output = ""
for line in content.split('\r\n'):
    newline = line.strip(' ').replace('\xa1\xa1','').strip(' ')
    if not newline:
        continue
    output += (newline + '\r\n\r\n')
pyperclip.copy(output)
</code></pre>

</section>
<section class="meta">
<span class="author">
	<a href="http://yuliu.org">刘昱</a>
</span>
<span class="time">
	/
	
	<time datetime="2012-07-27">2012-07-27</time> 更新
	
</span>
<br />

<span class="categories">
	分类： 
	
	<a href="http://yuliu.org/essay/categories.html#计算机" title="计算机">计算机</a>&nbsp;/
	
</span>


<span class="tags">
	标签： 
	
	<a href="http://yuliu.org/essay/tags.html#python" title="python">python</a>&nbsp;
	
</span>

</section>

<section class="comment">
<a href="#" id="show_disqus_comment" onclick="return false;">更多信息，请点击查看评论</a>
<div id="disqus_thread"></div>
</section>
<script type="text/javascript">
$(function(){
		$('section.comment #show_disqus_comment').on('click',function(){
			$(this).html('评论加载中<image src="/media/images/siteimg/loading.gif" class="loader-img" />');
			var disqus_shortname = 'yuliu'; // required: replace example with your forum shortname
			var disqus_url = 'http://yuliu.org/2012/07/python_file_clipboard_read_write/';
			// var disqus_developer = 1; 
			var that = this;
			// var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			var src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
			PSJS.loadScript(src, function(){$(that).remove()});
			});
		});
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



<script type="text/javascript">
	$(function(){
		$(document).keydown(function(e) {
			var url = false;
			if (e.which == 37 || e.which == 74) {  // Left arrow and J
				
				url = 'http://yuliu.org/2012/07/my_favorite_softwares/';
				
			}
			else if (e.which == 39 || e.which == 75) {  // Right arrow and K
				
				url = 'http://yuliu.org/2013/03/update_of_nuvi_205w_gps/';
				
			}
			if (url) {
				window.location = url;
			}
		});
	})
</script>


				</article>
				<div id="toc"></div>
			</div>
		</div>
	</body>
</html>
